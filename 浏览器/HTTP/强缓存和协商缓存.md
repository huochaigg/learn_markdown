
## 强缓存（直接使用缓存）

浏览器根据响应头 `Cache-Control` 或 `Expires` 判断资源是否“还没过期”，如果没过期，**不请求服务器，直接用本地缓存**。

```
Cache-Control: max-age=3600
```

表示资源在 3600 秒内有效，期间内访问该资源直接从本地读缓存。

Expires（已过时但仍兼容）:

```
Expires: Wed, 18 May 2025 10:00:00 GMT
```

表示资源在某个时间点前都有效。
二者同时存在时，`Cache-Control` 优先生效。


## 协商缓存（向服务器验证是否更新）

强缓存过期后，浏览器会发请求问服务端：“我这个资源是旧的吗？”

如果资源**没变**，服务端返回：

```
304 Not Modified
```

浏览器接着用本地缓存。否则就返回新的资源。

|浏览器请求头|服务器响应头|说明|
|---|---|---|
|`If-Modified-Since`|`Last-Modified`|比较修改时间（秒级精度，不太精确）|
|`If-None-Match`|`ETag`|更精确，用 hash 校验内容是否一致|
#### 示例流程：

1. 浏览器发请求带上：

```
If-None-Match: "xyz123"
```

2. 服务端对比 ETag，如果一致，返回：

```
HTTP/1.1 304 Not Modified
```

3. 浏览器使用本地缓存版本。


## 开发建议

| 资源类型             | 缓存建议                                    |
| ---------------- | --------------------------------------- |
| 静态资源（js/css/img） | 使用强缓存 + 文件名加 hash + 永久有效时间              |
| HTML             | 一般不缓存或只用协商缓存                            |
| 接口数据             | 尽量用后端控制 `ETag` / `Last-Modified` 实现协商缓存 |

- 强缓存命中，**请求都不会发送**。
    
- 协商缓存命中，**会发送请求，但资源不再下载**。
    
- 浏览器按顺序先检查强缓存，再协商缓存。
    
- **只有 GET 请求会缓存**，POST 默认不走缓存。


## 为什么js，css使用强缓存

因为一般来说前端打包时会把js，css文件加上hash比如 style.asdasdasd123123.css
如果内容变了，就会改变hash值，
文件名变，缓存自动失效，不怕更新问题，
所以可以放心把时间改成一年过期，max-age=31536000


### CDN 缓存机制

和浏览器缓存策略保持一致，避免冲突

#### TODO 待完善

## 查看和调试缓存：

1. 打开浏览器 DevTools → Network → 查看请求 headers：
    
    - 查看是否命中 **disk cache / memory cache**
        
    - 查看响应头中 `cache-control`, `etag`, `last-modified`
        
2. 如果想强制刷新跳过缓存：
    
    - macOS: `Cmd + Shift + R`
        
    - Windows: `Ctrl + Shift + R`